{% extends 'base_tailwind.html' %}
{% load widget_tweaks %}

{% block title %}Upfront Payment - PalmCash{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">
            <i class="fas fa-credit-card text-blue-600 mr-3"></i>
            Upfront Payment Required
        </h1>
        <p class="text-gray-600">Complete your loan application by paying the 10% upfront payment</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Main Content -->
        <div class="lg:col-span-2">
            <!-- Loan Summary Card -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-900 mb-4">Loan Summary</h2>
                
                <div class="space-y-3 border-b pb-4 mb-4">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Loan Application #</span>
                        <span class="font-semibold text-gray-900">{{ loan.application_number }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Loan Type</span>
                        <span class="font-semibold text-gray-900">{{ loan.loan_type.name }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Principal Amount</span>
                        <span class="font-semibold text-gray-900">K{{ principal_amount|floatformat:2 }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Interest Rate</span>
                        <span class="font-semibold text-gray-900">{{ interest_rate }}%</span>
                    </div>
                </div>

                <!-- Upfront Payment Calculation -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h3 class="font-semibold text-gray-900 mb-3">Upfront Payment Calculation</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Principal Amount</span>
                            <span class="text-gray-900">K{{ principal_amount|floatformat:2 }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Upfront Payment (10%)</span>
                            <span class="text-blue-600 font-semibold">K{{ upfront_amount|floatformat:2 }}</span>
                        </div>
                        <div class="border-t border-blue-200 pt-2 mt-2 flex justify-between">
                            <span class="font-semibold text-gray-900">Amount Due</span>
                            <span class="text-lg font-bold text-blue-600">K{{ upfront_amount|floatformat:2 }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Payment Form -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-bold text-gray-900 mb-4">Payment Details</h2>
                
                <form method="post" class="space-y-4">
                    {% csrf_token %}

                    <!-- Payment Method -->
                    <div>
                        <label for="payment_method" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-wallet text-blue-600 mr-2"></i>Payment Method *
                        </label>
                        <select name="payment_method" id="payment_method" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">-- Select Payment Method --</option>
                            <option value="bank_transfer">Bank Transfer</option>
                            <option value="mobile_money">Mobile Money</option>
                            <option value="cash">Cash Payment</option>
                            <option value="check">Check</option>
                            <option value="other">Other</option>
                        </select>
                        <p class="text-xs text-gray-500 mt-1">Choose how you will make this payment</p>
                    </div>

                    <!-- Reference Number -->
                    <div>
                        <label for="reference_number" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-hashtag text-blue-600 mr-2"></i>Payment Reference Number *
                        </label>
                        <input type="text" name="reference_number" id="reference_number" required 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="e.g., Transaction ID, Check Number, Mobile Money Reference">
                        <p class="text-xs text-gray-500 mt-1">Enter the transaction or reference number for this payment</p>
                    </div>

                    <!-- Info Box -->
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <p class="text-sm text-green-800">
                            <i class="fas fa-info-circle mr-2"></i>
                            <strong>Note:</strong> Your payment will be reviewed and confirmed by our team. 
                            Once confirmed, your loan will be approved for disbursement.
                        </p>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex gap-3 pt-4 border-t">
                        <a href="{% url 'loans:list' %}" class="flex-1 px-4 py-2 bg-gray-200 text-gray-900 rounded-lg hover:bg-gray-300 transition font-medium text-center">
                            <i class="fas fa-arrow-left mr-2"></i>Cancel
                        </a>
                        <button type="submit" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium">
                            <i class="fas fa-check-circle mr-2"></i>Submit Payment
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="lg:col-span-1">
            <!-- Payment Status Card -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h3 class="text-lg font-bold text-gray-900 mb-4">Payment Status</h3>
                <div class="space-y-3">
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center mr-3">
                            <i class="fas fa-check text-sm"></i>
                        </div>
                        <span class="text-sm text-gray-700">Application Submitted</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center mr-3">
                            <i class="fas fa-spinner text-sm"></i>
                        </div>
                        <span class="text-sm font-semibold text-gray-900">Upfront Payment</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-gray-200 text-gray-400 flex items-center justify-center mr-3">
                            <i class="fas fa-lock text-sm"></i>
                        </div>
                        <span class="text-sm text-gray-600">Loan Approval</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-gray-200 text-gray-400 flex items-center justify-center mr-3">
                            <i class="fas fa-money-bill text-sm"></i>
                        </div>
                        <span class="text-sm text-gray-600">Disbursement</span>
                    </div>
                </div>
            </div>

            <!-- Help Card -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                <h3 class="text-lg font-bold text-blue-900 mb-3">Need Help?</h3>
                <p class="text-sm text-blue-800 mb-4">
                    If you have questions about this payment or need assistance, please contact our support team.
                </p>
                <div class="space-y-2 text-sm">
                    <p class="text-blue-800">
                        <i class="fas fa-phone mr-2"></i>
                        <strong>Phone:</strong> +260 XXX XXX XXX
                    </p>
                    <p class="text-blue-800">
                        <i class="fas fa-envelope mr-2"></i>
                        <strong>Email:</strong> support@palmcash.com
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
