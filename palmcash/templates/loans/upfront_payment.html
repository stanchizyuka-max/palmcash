{% extends 'base_tailwind.html' %}
{% load humanize %}

{% block title %}Upfront Payment - {{ loan.application_number }} - Palm Cash{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="mb-8">
        <a href="{% url 'loans:detail' loan.pk %}" class="text-primary-600 hover:text-primary-700 mb-4 inline-flex items-center">
            <i class="fas fa-arrow-left mr-2"></i>Back to Loan Details
        </a>
        <h1 class="text-3xl font-bold text-secondary-900 mt-4">
            <i class="fas fa-money-bill-wave text-primary-600 mr-3"></i>
            Upfront Payment Required
        </h1>
        <p class="text-secondary-600 mt-2">Loan Application: {{ loan.application_number }}</p>
    </div>

    <!-- Payment Information Card -->
    <div class="bg-gradient-to-r from-primary-50 to-primary-100 border-l-4 border-primary-600 rounded-lg p-6 mb-8">
        <div class="flex items-start">
            <div class="flex-shrink-0">
                <i class="fas fa-info-circle text-primary-600 text-2xl"></i>
            </div>
            <div class="ml-4">
                <h3 class="text-lg font-semibold text-primary-900 mb-2">10% Upfront Payment Required</h3>
                <p class="text-primary-800 mb-4">
                    Before your loan can be approved and disbursed, you must pay 10% of the requested loan amount as an upfront payment. 
                    This payment demonstrates your commitment and helps us process your application faster.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                    <div class="bg-white rounded-lg p-4">
                        <div class="text-sm text-secondary-600">Loan Amount Requested</div>
                        <div class="text-2xl font-bold text-secondary-900">K{{ loan.principal_amount|floatformat:2|intcomma }}</div>
                    </div>
                    <div class="bg-primary-600 text-white rounded-lg p-4">
                        <div class="text-sm opacity-90">Upfront Payment Required (10%)</div>
                        <div class="text-2xl font-bold">K{{ upfront_amount|floatformat:2|intcomma }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Form -->
    <div class="bg-white rounded-xl shadow-lg p-8">
        <h2 class="text-2xl font-bold text-secondary-900 mb-6">
            <i class="fas fa-credit-card text-primary-600 mr-2"></i>
            Submit Payment Details
        </h2>

        <form method="post" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}

            <!-- Amount -->
            <div>
                <label class="block text-sm font-semibold text-secondary-700 mb-2">
                    <i class="fas fa-money-bill-wave text-primary-600 mr-2"></i>Payment Amount (ZMW) *
                </label>
                {{ form.amount_paid }}
                {% if form.amount_paid.help_text %}
                <p class="text-sm text-secondary-500 mt-1">{{ form.amount_paid.help_text }}</p>
                {% endif %}
                {% if form.amount_paid.errors %}
                <p class="text-sm text-red-600 mt-1">{{ form.amount_paid.errors }}</p>
                {% endif %}
            </div>

            <!-- Payment Method -->
            <div>
                <label class="block text-sm font-semibold text-secondary-700 mb-2">
                    <i class="fas fa-wallet text-primary-600 mr-2"></i>Payment Method *
                </label>
                {{ form.payment_method }}
                {% if form.payment_method.errors %}
                <p class="text-sm text-red-600 mt-1">{{ form.payment_method.errors }}</p>
                {% endif %}
            </div>

            <!-- Payment Reference -->
            <div>
                <label class="block text-sm font-semibold text-secondary-700 mb-2">
                    <i class="fas fa-hashtag text-primary-600 mr-2"></i>Payment Reference/Transaction ID *
                </label>
                {{ form.payment_reference }}
                {% if form.payment_reference.help_text %}
                <p class="text-sm text-secondary-500 mt-1">{{ form.payment_reference.help_text }}</p>
                {% endif %}
                {% if form.payment_reference.errors %}
                <p class="text-sm text-red-600 mt-1">{{ form.payment_reference.errors }}</p>
                {% endif %}
            </div>

            <!-- Payment Proof -->
            <div>
                <label class="block text-sm font-semibold text-secondary-700 mb-2">
                    <i class="fas fa-file-upload text-primary-600 mr-2"></i>Upload Payment Proof (Optional)
                </label>
                {{ form.payment_proof }}
                {% if form.payment_proof.help_text %}
                <p class="text-sm text-secondary-500 mt-1">{{ form.payment_proof.help_text }}</p>
                {% endif %}
                {% if form.payment_proof.errors %}
                <p class="text-sm text-red-600 mt-1">{{ form.payment_proof.errors }}</p>
                {% endif %}
            </div>

            <!-- Notes -->
            <div>
                <label class="block text-sm font-semibold text-secondary-700 mb-2">
                    <i class="fas fa-comment text-primary-600 mr-2"></i>Additional Notes
                </label>
                {{ form.notes }}
                {% if form.notes.errors %}
                <p class="text-sm text-red-600 mt-1">{{ form.notes.errors }}</p>
                {% endif %}
            </div>

            <!-- Payment Instructions -->
            <div class="bg-secondary-50 rounded-lg p-6 border border-secondary-200">
                <h3 class="font-semibold text-secondary-900 mb-3">
                    <i class="fas fa-info-circle text-primary-600 mr-2"></i>Payment Instructions
                </h3>
                <ul class="space-y-2 text-sm text-secondary-700">
                    <li class="flex items-start">
                        <i class="fas fa-check text-primary-600 mr-2 mt-1"></i>
                        <span>Make payment to Palm Cash account using your preferred method</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check text-primary-600 mr-2 mt-1"></i>
                        <span>Keep your payment receipt/confirmation</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check text-primary-600 mr-2 mt-1"></i>
                        <span>Enter the transaction reference number in the form above</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check text-primary-600 mr-2 mt-1"></i>
                        <span>Upload proof of payment (screenshot or receipt)</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check text-primary-600 mr-2 mt-1"></i>
                        <span>Our team will verify your payment within 24 hours</span>
                    </li>
                </ul>
            </div>

            <!-- Submit Buttons -->
            <div class="flex gap-4 pt-4">
                <button type="submit" class="flex-1 bg-primary-600 hover:bg-primary-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 shadow-lg hover:shadow-xl">
                    <i class="fas fa-paper-plane mr-2"></i>Submit Payment Details
                </button>
                <a href="{% url 'loans:detail' loan.pk %}" class="flex-1 bg-secondary-200 hover:bg-secondary-300 text-secondary-700 font-semibold py-3 px-6 rounded-lg transition-colors duration-200 text-center">
                    <i class="fas fa-times mr-2"></i>Cancel
                </a>
            </div>
        </form>
    </div>

    <!-- Help Section -->
    <div class="mt-8 bg-white rounded-xl shadow-lg p-6">
        <h3 class="text-lg font-semibold text-secondary-900 mb-4">
            <i class="fas fa-question-circle text-primary-600 mr-2"></i>Need Help?
        </h3>
        <p class="text-secondary-600 mb-4">
            If you have any questions about the upfront payment or need assistance, please contact our support team:
        </p>
        <div class="flex flex-wrap gap-4">
            <div class="flex items-center text-secondary-700">
                <i class="fas fa-phone text-primary-600 mr-2"></i>
                <span>+260 211 123 456</span>
            </div>
            <div class="flex items-center text-secondary-700">
                <i class="fas fa-envelope text-primary-600 mr-2"></i>
                <span>support@palmcash.zm</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}
