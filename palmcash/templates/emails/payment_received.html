{% extends 'emails/base_email.html' %}
{% load humanize %}

{% block title %}Payment Confirmation - LoanVista{% endblock %}
{% block header_subtitle %}Payment Received{% endblock %}

{% block content %}
<h2 style="color: #1f2937; margin: 0 0 20px 0; font-size: 24px;">
    Thank You{% if borrower.first_name %}, {{ borrower.first_name }}{% endif %}!
</h2>

<div style="background-color: #d1fae5; border-left: 4px solid #10b981; padding: 15px; margin: 0 0 30px 0; border-radius: 4px;">
    <p style="color: #065f46; margin: 0; font-size: 16px; font-weight: bold;">
        âœ… Payment Received Successfully
    </p>
</div>

<p style="color: #4b5563; line-height: 1.6; margin: 0 0 20px 0;">
    We've received your payment for loan <strong>#{{ loan.application_number }}</strong>. Here are the details:
</p>

<!-- Payment Details -->
<table width="100%" cellpadding="10" cellspacing="0" style="background-color: #f9fafb; border-radius: 8px; margin: 0 0 30px 0;">
    <tr>
        <td colspan="2" style="color: #1f2937; font-size: 16px; font-weight: bold; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px;">
            ðŸ’³ Payment Receipt
        </td>
    </tr>
    <tr>
        <td style="color: #6b7280; font-size: 14px; border-bottom: 1px solid #e5e7eb;">
            Payment Number:
        </td>
        <td style="color: #1f2937; font-size: 14px; text-align: right; border-bottom: 1px solid #e5e7eb;">
            <strong>{{ payment.payment_number }}</strong>
        </td>
    </tr>
    <tr>
        <td style="color: #6b7280; font-size: 14px; border-bottom: 1px solid #e5e7eb;">
            Amount Paid:
        </td>
        <td style="color: #10b981; font-size: 16px; text-align: right; border-bottom: 1px solid #e5e7eb;">
            <strong>K{{ payment.amount|floatformat:2|intcomma }}</strong>
        </td>
    </tr>
    <tr>
        <td style="color: #6b7280; font-size: 14px; border-bottom: 1px solid #e5e7eb;">
            Payment Date:
        </td>
        <td style="color: #1f2937; font-size: 14px; text-align: right; border-bottom: 1px solid #e5e7eb;">
            {{ payment.payment_date|date:"M d, Y H:i" }}
        </td>
    </tr>
    <tr>
        <td style="color: #6b7280; font-size: 14px; border-bottom: 1px solid #e5e7eb;">
            Payment Method:
        </td>
        <td style="color: #1f2937; font-size: 14px; text-align: right; border-bottom: 1px solid #e5e7eb;">
            {{ payment.get_payment_method_display }}
        </td>
    </tr>
    {% if payment.reference_number %}
    <tr>
        <td style="color: #6b7280; font-size: 14px; border-bottom: 1px solid #e5e7eb;">
            Reference Number:
        </td>
        <td style="color: #1f2937; font-size: 14px; text-align: right; border-bottom: 1px solid #e5e7eb;">
            {{ payment.reference_number }}
        </td>
    </tr>
    {% endif %}
</table>

<!-- Loan Balance -->
<table width="100%" cellpadding="10" cellspacing="0" style="background-color: #eff6ff; border-radius: 8px; margin: 0 0 30px 0;">
    <tr>
        <td colspan="2" style="color: #1f2937; font-size: 16px; font-weight: bold; border-bottom: 2px solid #bfdbfe; padding-bottom: 10px;">
            ðŸ“Š Loan Balance Update
        </td>
    </tr>
    <tr>
        <td style="color: #1e40af; font-size: 14px; border-bottom: 1px solid #bfdbfe;">
            Total Loan Amount:
        </td>
        <td style="color: #1e40af; font-size: 14px; text-align: right; border-bottom: 1px solid #bfdbfe;">
            K{{ loan.total_amount|floatformat:2|intcomma }}
        </td>
    </tr>
    <tr>
        <td style="color: #1e40af; font-size: 14px; border-bottom: 1px solid #bfdbfe;">
            Amount Paid:
        </td>
        <td style="color: #10b981; font-size: 14px; text-align: right; border-bottom: 1px solid #bfdbfe;">
            K{{ loan.amount_paid|floatformat:2|intcomma }}
        </td>
    </tr>
    <tr>
        <td style="color: #1e40af; font-size: 14px;">
            <strong>Balance Remaining:</strong>
        </td>
        <td style="color: #1e40af; font-size: 16px; text-align: right;">
            <strong>K{{ loan.balance_remaining|floatformat:2|intcomma }}</strong>
        </td>
    </tr>
</table>

<!-- Progress Bar -->
<div style="margin: 0 0 30px 0;">
    <p style="color: #6b7280; margin: 0 0 10px 0; font-size: 14px;">
        <strong>Loan Completion:</strong> {{ loan.completion_percentage|floatformat:0 }}%
    </p>
    <div style="background-color: #e5e7eb; height: 20px; border-radius: 10px; overflow: hidden;">
        <div style="background: linear-gradient(90deg, #10b981 0%, #059669 100%); height: 100%; width: {{ loan.completion_percentage }}%; border-radius: 10px;"></div>
    </div>
</div>

<!-- Action Buttons -->
<table width="100%" cellpadding="0" cellspacing="0">
    <tr>
        <td align="center" style="padding: 0 0 20px 0;">
            <a href="{{ site_url }}/payments/schedule/{{ loan.id }}/" 
               style="display: inline-block; padding: 15px 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #ffffff; text-decoration: none; border-radius: 6px; font-weight: bold; font-size: 16px;">
                View Payment Schedule
            </a>
        </td>
    </tr>
</table>

<p style="color: #6b7280; line-height: 1.6; margin: 0; font-size: 14px;">
    Thank you for your payment. Keep up the great work!
</p>
{% endblock %}
