{% extends 'base_tailwind.html' %}
{% load static %}

{% block title %}Approval Detail - {{ approval_type_display }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-secondary-50 via-primary-50 to-secondary-50 py-12">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="mb-8">
            <a href="{% url 'dashboard:pending_approvals' %}" class="text-primary-600 hover:text-primary-700 mb-4 inline-flex items-center">
                <i class="fas fa-arrow-left mr-2"></i>Back to Pending Approvals
            </a>
            <h1 class="text-4xl font-bold text-secondary-900 mb-2">
                <i class="fas fa-clipboard-check text-primary-600 mr-3"></i>
                {{ approval_type_display }} Approval
            </h1>
            <p class="text-lg text-secondary-600">Review and approve or reject this request</p>
        </div>

        <!-- Approval Details Card -->
        <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Loan Information -->
                <div>
                    <h2 class="text-xl font-bold text-secondary-900 mb-4">
                        <i class="fas fa-info-circle text-primary-600 mr-2"></i>Loan Information
                    </h2>
                    
                    {% if loan %}
                    <div class="space-y-4">
                        <div>
                            <p class="text-sm text-secondary-600 font-semibold">Loan ID</p>
                            <p class="text-lg text-secondary-900">#{{ loan.id }}</p>
                        </div>
                        
                        <div>
                            <p class="text-sm text-secondary-600 font-semibold">Borrower</p>
                            <p class="text-lg text-secondary-900">{{ loan.borrower.full_name }}</p>
                        </div>
                        
                        <div>
                            <p class="text-sm text-secondary-600 font-semibold">Principal Amount</p>
                            <p class="text-lg text-secondary-900">K{{ loan.principal_amount|floatformat:2 }}</p>
                        </div>
                        
                        <div>
                            <p class="text-sm text-secondary-600 font-semibold">Loan Status</p>
                            <p class="text-lg">
                                {% if loan.status == 'active' %}
                                    <span class="px-3 py-1 bg-success-100 text-success-700 rounded-full text-sm font-bold">Active</span>
                                {% elif loan.status == 'pending' %}
                                    <span class="px-3 py-1 bg-warning-100 text-warning-700 rounded-full text-sm font-bold">Pending</span>
                                {% elif loan.status == 'completed' %}
                                    <span class="px-3 py-1 bg-info-100 text-info-700 rounded-full text-sm font-bold">Completed</span>
                                {% else %}
                                    <span class="px-3 py-1 bg-secondary-100 text-secondary-700 rounded-full text-sm font-bold">{{ loan.get_status_display }}</span>
                                {% endif %}
                            </p>
                        </div>
                    </div>
                    {% else %}
                    <p class="text-secondary-600">No loan information available</p>
                    {% endif %}
                </div>

                <!-- Approval Details -->
                <div>
                    <h2 class="text-xl font-bold text-secondary-900 mb-4">
                        <i class="fas fa-check-circle text-primary-600 mr-2"></i>{{ approval_type_display }} Details
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <p class="text-sm text-secondary-600 font-semibold">Approval Type</p>
                            <p class="text-lg text-secondary-900">{{ approval_type_display }}</p>
                        </div>
                        
                        {% if approval.amount %}
                        <div>
                            <p class="text-sm text-secondary-600 font-semibold">Amount</p>
                            <p class="text-lg text-secondary-900">K{{ approval.amount|floatformat:2 }}</p>
                        </div>
                        {% endif %}
                        
                        {% if approval.is_verified is not None %}
                        <div>
                            <p class="text-sm text-secondary-600 font-semibold">Current Status</p>
                            <p class="text-lg">
                                {% if approval.is_verified %}
                                    <span class="px-3 py-1 bg-success-100 text-success-700 rounded-full text-sm font-bold">Verified</span>
                                {% else %}
                                    <span class="px-3 py-1 bg-warning-100 text-warning-700 rounded-full text-sm font-bold">Pending Verification</span>
                                {% endif %}
                            </p>
                        </div>
                        {% elif approval.status %}
                        <div>
                            <p class="text-sm text-secondary-600 font-semibold">Current Status</p>
                            <p class="text-lg">
                                {% if approval.status == 'pending' %}
                                    <span class="px-3 py-1 bg-warning-100 text-warning-700 rounded-full text-sm font-bold">Pending</span>
                                {% elif approval.status == 'approved' %}
                                    <span class="px-3 py-1 bg-success-100 text-success-700 rounded-full text-sm font-bold">Approved</span>
                                {% elif approval.status == 'rejected' %}
                                    <span class="px-3 py-1 bg-danger-100 text-danger-700 rounded-full text-sm font-bold">Rejected</span>
                                {% else %}
                                    <span class="px-3 py-1 bg-secondary-100 text-secondary-700 rounded-full text-sm font-bold">{{ approval.get_status_display }}</span>
                                {% endif %}
                            </p>
                        </div>
                        {% endif %}
                        
                        <div>
                            <p class="text-sm text-secondary-600 font-semibold">Branch</p>
                            <p class="text-lg text-secondary-900">{{ branch.name }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="bg-white rounded-lg shadow-lg p-8">
            <h2 class="text-xl font-bold text-secondary-900 mb-6">
                <i class="fas fa-tasks text-primary-600 mr-2"></i>Take Action
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Approve Form -->
                <form method="post" action="{% url 'dashboard:approval_approve' approval.id %}" class="space-y-4">
                    {% csrf_token %}
                    <input type="hidden" name="type" value="{{ approval_type }}">
                    
                    <div>
                        <label for="approve_comments" class="block text-sm font-semibold text-secondary-900 mb-2">
                            Comments (Optional)
                        </label>
                        <textarea 
                            id="approve_comments" 
                            name="comments" 
                            rows="4"
                            placeholder="Add any comments about this approval..."
                            class="w-full px-4 py-2 border border-secondary-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
                        ></textarea>
                    </div>
                    
                    <button 
                        type="submit" 
                        class="w-full bg-success-600 hover:bg-success-700 text-white font-bold py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center"
                    >
                        <i class="fas fa-check-circle mr-2"></i>Approve
                    </button>
                </form>

                <!-- Reject Form -->
                <form method="post" action="{% url 'dashboard:approval_reject' approval.id %}" class="space-y-4">
                    {% csrf_token %}
                    <input type="hidden" name="type" value="{{ approval_type }}">
                    
                    <div>
                        <label for="reject_comments" class="block text-sm font-semibold text-secondary-900 mb-2">
                            Rejection Reason (Required)
                        </label>
                        <textarea 
                            id="reject_comments" 
                            name="comments" 
                            rows="4"
                            placeholder="Please provide a reason for rejection..."
                            required
                            class="w-full px-4 py-2 border border-secondary-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-danger-500"
                        ></textarea>
                    </div>
                    
                    <button 
                        type="submit" 
                        class="w-full bg-danger-600 hover:bg-danger-700 text-white font-bold py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center"
                    >
                        <i class="fas fa-times-circle mr-2"></i>Reject
                    </button>
                </form>
            </div>
        </div>

        <!-- Info Box -->
        <div class="mt-8 bg-info-50 border-l-4 border-info-600 p-6 rounded">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-info-circle text-info-600 text-2xl"></i>
                </div>
                <div class="ml-4">
                    <h3 class="text-lg font-semibold text-info-900">Important</h3>
                    <p class="text-info-800 mt-2">
                        Your approval or rejection will be logged with a timestamp and stored for audit purposes. 
                        Please ensure you have reviewed all details before taking action.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
